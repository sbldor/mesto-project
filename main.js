(()=>{"use strict";var e=function(e,t,n){return t.querySelector("#".concat(e.name+n.errorClass))},t=function(t,n,r){var o=e(t,n,r);t.classList.remove(r.inputErrorClass),o.textContent=""},n=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1};function r(e,r){!function(e,r){var o=Array.from(e.querySelectorAll(r.inputSelector)),c=e.querySelector(r.submitButtonSelector);o.forEach((function(a){t(a,e,r),n(c,o)})),n(c,o)}(r,e)}var o=document.querySelectorAll(".popup"),c=Array.from(document.querySelectorAll(".popup__button-closed"));function a(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i)}function u(){document.removeEventListener("keydown",i),o.forEach((function(e){e.classList.remove("popup_opened")}))}function i(e){"Escape"===e.key&&u()}o.forEach((function(e){e.addEventListener("click",(function(e){e.target===e.currentTarget&&u()}))})),c.forEach((function(e){e.addEventListener("click",u)}));var l={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"6964e665-5711-4931-96f3-452c660b2bf9","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так( Ошибка: ".concat(e.status))},d=document.getElementById("popup-cards-open"),f=document.querySelector("#cards").content;function m(e,t){var n=f.querySelector(".cards__card").cloneNode(!0),r=n.querySelector(".cards__image"),o=n.querySelector(".cards__name"),c=n.querySelector(".cards__counter"),u=n.querySelector(".cards__button"),i=n.querySelector(".cards__button-delite");return r.alt=e.name,r.src=e.link,o.textContent=e.name,function(e,t,n){e.owner._id!==t._id&&n.classList.add("cards__button-delite_enabled")}(e,t,i),function(e,t,n,r){n.textContent=e.likes.length,e.likes.some((function(e){return e._id===t._id}))&&r.classList.add("cards__button_active")}(e,t,c,u),r.addEventListener("click",(function(){return function(e,t){e.querySelector(".popup__image").src=t.link,e.querySelector(".popup__image").alt=t.name,e.querySelector(".popup__image-title").textContent=t.name,a(e)}(d,e)})),u.addEventListener("click",(function(t){return function(e,t,n){var r=t._id,o=e.target;o.classList.contains("cards__button_active")?function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then(s)}(r).then((function(e){o.classList.remove("cards__button_active"),n.textContent=e.likes.length})):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then(s)}(r).then((function(e){o.classList.add("cards__button_active"),n.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}(t,e,c)})),i.addEventListener("click",(function(){return function(e,t){var n;(n=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:l.headers}).then(s)).then((function(){t.remove()})).catch((function(e){return console.log(e)}))}(e,n)})),n}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h,p,v=document.querySelector("#popup-edit"),_=v.querySelector(".form"),b=document.getElementById("name"),S=document.getElementById("description"),E=document.querySelector(".profile__button-edit"),q=_.querySelector(".form__button"),g=document.querySelector("#popup-cards"),C=document.querySelector(".profile__name"),L=document.querySelector(".profile__description"),k=document.querySelector(".cards"),x=g.querySelector(".form"),A=document.getElementById("cardname"),U=document.getElementById("cardlink"),B=document.querySelector(".profile__button-add"),I=x.querySelector(".form__button"),T=document.querySelector(".profile__avatar"),w=document.querySelector(".profile__avatar-container"),j=document.querySelector("#popup-avatar"),D=j.querySelector(".form"),O=document.getElementById("avatar"),P=D.querySelector(".form__button"),N={formSelector:".form",inputSelector:".form__text",submitButtonSelector:".form__button",inputErrorClass:"form__text_error",errorClass:"-error"};function J(e,t){C.textContent=e,L.textContent=t}function H(e){k.append(e)}Promise.all([fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(s),fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(s)]).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return c}}(n,r)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];c.forEach((function(e){H(m(e,a))})),J(a.name,a.about),t=a.avatar,T.src=t,h=a})).catch((function(e){console.log(e)})),_.addEventListener("submit",(function(e){var t;e.preventDefault(),q.textContent="Сохранение...",(t={name:b.value,about:S.value},fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t.name,about:t.about})}).then(s)).then((function(e){J(e.name,e.about),u()})).catch((function(e){return console.log(e)})).finally((function(){return q.textContent="Сохранить"}))})),E.addEventListener("click",(function(){r(N,_),a(v),b.value=C.textContent,S.value=L.textContent})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),I.textContent="Создание...",(t={name:A.value,link:U.value},fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(s)).then((function(e){H(m(e,h)),x.reset(),u()})).catch((function(e){return console.log(e)})).finally((function(){return q.textContent="Создать"}))})),B.addEventListener("click",(function(){r(N,x),x.reset(),a(g)})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),P.textContent="Сохранение...",(t=O.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(s)).then((function(e){T.src=e.avatar,D.reset(),u()})).catch((function(e){return console.log(e)})).finally((function(){return q.textContent="Сохранить"}))})),w.addEventListener("click",(function(){r(N,D),D.reset(),a(j)})),p=N,Array.from(document.querySelectorAll(p.formSelector)).forEach((function(r){!function(r,o){r.addEventListener("submit",(function(e){e.preventDefault()}));var c=Array.from(r.querySelectorAll(o.inputSelector)),a=r.querySelector(o.submitButtonSelector);c.forEach((function(u){u.addEventListener("input",(function(){(function(n,r,o){n.validity.valid?t(n,r,o):function(t,n,r){var o=e(t,n,r);t.classList.add(r.inputErrorClass),o.textContent=t.validationMessage}(n,r,o)})(u,r,o),n(a,c)})),n(a,c)}))}(r,p)}))})();